本節では、粒子群クラスについて記述する。このクラスは粒子情報の保持や
MPIプロセス間で粒子情報の交換を行うモジュールである。まずオブジェクト
の生成方法を記述し、その後APIを記述する。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsection{オブジェクトの生成}

粒子群クラスは以下のように宣言されている。
\begin{lstlisting}[caption=ParticleSystem0]
namespace ParticleSimulator {
    template<class Tptcl>
    class ParticleSystem;
}
namespace PS = ParticleSimulator;
\end{lstlisting}
テンプレート引数Tptclはユーザー定義のFullParticle型である。

粒子群クラスのオブジェクトの生成は以下のように行う。ここではsystemとい
うオブジェクトを生成している。
\begin{screen}
\begin{verbatim}
PS::ParticleSystem<Tptcl> system;
\end{verbatim}
\end{screen}
テンプレート引数Tptclはユーザー定義のFullParticle型である。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsection{API}

このモジュールには初期設定関連のAPI、オブジェクト情報取得設定関連のAPI、
ファイル入出力関連のAPI、粒子交換関連のAPIがある。以下、各節に分けて記
述する。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsection{初期設定}

初期設定関連のAPIの宣言は以下のようになっている。このあと各APIについて
記述する。
\begin{lstlisting}[caption=ParticleSystem1]
namespace ParticleSimulator {
    template<class Tptcl>
    class ParticleSystem{
    public:
        ParticleSystem();
        void initialize();
        void setNumberOfDomainMultiDimension(const S32 nx,
                                             const S32 ny,
                                             const S32 nz=1);
        void setAverageTargetNumberOfSampleParticlePerProcess
                        (const S32 & nsampleperprocess);
        void createParticle(const S32 n_limit);
    };
}
namespace PS = ParticleSimulator;
\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{コンストラクタ}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::ParticleSystem();
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

なし

\item {\bf 返値}

なし

\item {\bf 機能}

粒子群クラスのオブジェクトを生成する。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{initialize}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::initialize();
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

なし

\item {\bf 返値}

なし

\item {\bf 機能}

粒子群クラスのオブジェクトを初期化する。１度は呼ぶ必要があるが、２度呼
ぶと例外が送出される。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{createParticle} %% 必要？

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::createParticle
                 (const PS::S32 n_limit);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

n\_limit: 入力。 const PS::S32型。粒子配列の上限。

%%clear: 入力。 bool型。   デフォルトtrue。

\item {\bf 返値}

なし

\item {\bf 機能}

粒子配列のメモリを確保する。n\_limitには１つのMPIプロセスで扱う粒子数
の上限数を入力する。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{setAverateTargetNumberOfSampleParticlePerProcess}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::setAverateTargetNumberOfSampleParticlePerProcess
                 (const PS::S32 & nsampleperprocess);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

nsampleperprocess: 入力。const PS::S32 \&型。１つのMPIプロセスでサンプル
する粒子数目標。

\item {\bf 返値}

なし

\item {\bf 機能}

１つのMPIプロセスでサンプルする粒子数の目標を設定する。呼び出さなくて
もよいが、呼び出さないとこの目標数が30となる。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsection{オブジェクト情報の取得設定}

オブジェクト情報取得関連のAPIの宣言は以下のようになっている。このあと
各APIについて記述する。
\begin{lstlisting}[caption=ParticleSystem2]
namespace ParticleSimulator {
    template<class Tptcl>
    class ParticleSystem{
    public
        Tptcl & operator [] (const S32 id);
        void setNumberOfParticleLocal(const S32 n);
        const S32 getNumberOfParticleLocal();
        S32 getNumberOfParticleGlobal();
    };
}
namespace PS = ParticleSimulator;
\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{operator []}

\begin{screen}
\begin{verbatim}
Tptcl & PS::ParticleSystem::operator []
             (const S32 id);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

n: 入力。const PS::S32型。粒子配列のインデックス。

\item {\bf 返値}

Tptcl型。Tptcl型のオブジェクト１つ。

\item {\bf 機能}

Tptcl型のオブジェクト１つ返す。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{setNumberOfParticleLocal}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::setNumberOfParticleLocal
                 (const PS::S32 n);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

n: 入力。const PS::S32型。粒子数。

\item {\bf 返値}

なし

\item {\bf 機能}

１つのMPIプロセスの持つ粒子数を設定する。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{getNumberOfParticleLocal}

\begin{screen}
\begin{verbatim}
const PS::S32 PS::ParticleSystem::getNumberOfParticleLocal();
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

なし

\item {\bf 返値}

const PS::S32型。１つのMPIプロセスの持つ粒子数。

\item {\bf 機能}

１つのMPIプロセスの持つ粒子数を返す。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{getNumberOfParticleGlobal}

\begin{screen}
\begin{verbatim}
const PS::S32 PS::ParticleSystem::getNumberOfParticleGlobal();
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

なし

\item {\bf 返値}

const PS::S32型。全MPIプロセスの持つ粒子数。

\item {\bf 機能}

全MPIプロセスの持つ粒子数を返す。

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsection{ファイル入出力}

ファイル入出力関連のAPIの宣言は以下のようになっている。このあと各APIに
ついて記述する。
\begin{lstlisting}[caption=ParticleSystem3]
namespace ParticleSimulator {
    template<class Tptcl>
    class ParticleSystem{
    public
        template <class Theader>
        void readParticleAscii(const char * const filename,
                               const char * const format,
                               Theader & header);
        void readParticleAscii(const char * const filename,       
                               const char * const format);
        template <class Theader>
        void readParticleAscii(const char * const filename,
                               Theader & header);
        void readParticleAscii(const char * const filename);        
        template <class Theader>
        void writeParticleAscii(const char * const filename,
                                const char * const format,
                                const Theader & header);        
        template <class Theader>
        void writeParticleAscii(const char * const filename,
                                const Theader & header);
        void writeParticleAscii(const char * const filename,
                                const char * format);                                       
        void writeParticleAscii(const char * const filename);
    };
}
namespace PS = ParticleSimulator;
\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{readParticleAscii}
\label{sec:readParticleAscii}

\begin{screen}
\begin{verbatim}
template <class Theader>
void PS::ParticleSystem::readParticleAscii
                 (const char * const filename,
                  const char * const format,
                  Theader & header);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

format: 入力。const char * const型。

header: 入力。Theader \&型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
template <class Theader>
void PS::ParticleSystem::readParticleAscii
                 (const char * const filename,
                  Theader & header);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

header: 入力。Theader \&型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::readParticleAscii
                 (const char * const filename,
                  const char * const format);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

format: 入力。const char * const型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::readParticleAscii
                 (const char * const filename);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{readParticleBinary}
\label{sec:readParticleBinary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{writeParticlAscii}
\label{sec:writeParticleAscii}

\begin{screen}
\begin{verbatim}
template <class Theader>
void PS::ParticleSystem::writeParticleAscii
                 (const char * const filename,
                  const char * const format,
                  const Theader & header);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

format: 入力。const char * const型。

header: 入力。const Theader \&型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
template <class Theader>
void PS::ParticleSystem::writeParticleAscii
                 (const char * const filename,
                  const Theader & header);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

header: 入力。const Theader \&型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::writeParticleAscii
                 (const char * const filename,
                  const char * format);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

format: 入力。const char * 型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

\begin{screen}
\begin{verbatim}
void PS::ParticleSystem::writeParticleAscii
                 (const char * const filename);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

filename: 入力。const char * const型。

\item {\bf 返値}

なし

\item {\bf 機能}

\redtext{建設中}

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{writeParticleBinary}
\label{sec:writeParticleBinary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsection{粒子交換}

粒子交換関連のAPIの宣言は以下のようになっている。このあと各APIについて
記述する。
\begin{lstlisting}[caption=ParticleSystem4]
namespace ParticleSimulator {
    template<class Tptcl>
    class ParticleSystem{
    public
        template<class Tdinfo>
        void exchangeParticle(Tdinfo & dinfo);
    };
}
namespace PS = ParticleSimulator;
\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsubsubsubsection{exchangeParticle}

\begin{screen}
\begin{verbatim}
template<class Tdinfo>
void PS::ParticleSystem::exchangeParticle
                 (Tdinfo & dinfo);
\end{verbatim}
\end{screen}

\begin{itemize}

\item {\bf 引数}

dinfo: 入力。Tdinfo型。領域クラスのオブジェクト。

\item {\bf 返値}

なし

\item {\bf 機能}

粒子が適切なドメインに配置されるように、粒子の交換を行う。どのドメイン
にも属さない粒子が現れた場合、例外が送出される。

\end{itemize}
